{% extends "base_menu_generic.html" %}
{% load static %}
{% block head %}
    <link rel="stylesheet" href="{% static 'css/datepicker/bootstrap-datepicker3.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/fileinput/fileinput.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/fileinput/fileinput_theme.css' %}">
    <script src="{% static 'js/datepicker/bootstrap-datepicker.min.js' %}"></script>
    <script src="{% static 'js/datepicker/bootstrap-datepicker.ru.min.js' %}"></script>
    <script src="{% static 'js/fileinput/fileinput.js' %}"></script>
    <script src="{% static 'js/fileinput/fileinput_theme.js' %}"></script>
    <script src="{% static 'js/fileinput/fileinput_ru.js' %}"></script>
{% endblock %}
{% block main_content %}
    <div id="startData" style="display: none">
        <div id="variantFiles">
            {% for variant in variants %}
                <div class="startvar" id="startvar-{{ variant.id }}">
                    <p id="startvar-file_name">{{ variant.file_name }}</p>
                    <div class="startcrit" id="crit-{{ variant.criteria_obj.id }}">
                        <p id="startcrit-file_name"> {{ variant.criteria_obj.file_name }}</p>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
    <header>
        <h2>Реактирование мероприятия</h2>
        <hr>
    </header>
    <main class="page-block">
        <div class="main-settings pt-3 ms-2">
            <div class="head">
                <button class="d-inline image-button btn btn-sm btn-light">
                    <i class="fas fa-chevron-down"></i>
                </button>
                <h5 class="align-middle d-inline">Основные настройки</h5>
            </div>
            <form id="main-settings-form" class="px-3">
                <label class="create-event-form" for="inputEventName">
                    Название:
                    <input name="name" class="form-control w-50 event-input" id="inputEventName" placeholder="Мероприятие" required value="{{ event.name }}">
                </label>
                <label class="create-event-form" for="inputCalendar">Даты проведения:
                    <div class="w-50" id="inputCalendar">
                        <div class="input-daterange input-group" id="datepicker">
                            <label class="input-group-text calendar-input" style="border-left-color: rgb(18,18,18);" for="inputEventStartDate">c</label>
                            <input name="start_date" type="text" class="input-sm form-control calendar-input" id="inputEventStartDate" placeholder="01.12.2000" required value="{{ event.start_date }}"/>
                            <span class="input-group-text bg-white calendar-input">
                                <i class="fas fa-calendar-day"></i>
                            </span>
                            <label class="input-group-text px-3 calendar-input" for="inputEventEndDate">по</label>
                            <input name="end_date" type="text" class="input-sm form-control calendar-input" id="inputEventEndDate" placeholder="01.12.2000" required value="{{ event.end_date }}"/>
                            <span class="input-group-text bg-white calendar-input">
                                <i class="fas fa-calendar-day"></i>
                            </span>
                        </div>
                    </div>
                </label>
                <label class="edit-event-form" for="inputEventFiles">Варианты работ:</label>
                <table class="table table-bordered">
                    <thead class="variant-table">
                        <tr class="text-center">
                            <th scope="col">Текущий вариант</th>
                            <th scope="col">Новый вариант</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for variant in variants %}
                            <tr id="variant-{{ variant.id }}">
                                <td><button class="btn btn-success" id="{{ variant.id }}">{{ variant.file_name }}</button></td>
                                <td><input name="new_variant_file" type="file" accept="application/pdf"></td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <input class="mt-3 btn btn-primary" type="submit" value="Сохранить"/>
            </form>
        </div>

        <div class="templates-settings mt-4 ms-2">
            <div class="head">
                <button class="d-inline image-button btn btn-sm btn-light">
                    <i class="fas fa-chevron-down"></i>
                </button>
                <h5 class="align-middle d-inline">Настройка шаблонов вариантов</h5>
            </div>
            <form id="templates-settings-form" class="px-3 create-event-form mt-3" method="post" action="#">
                <table class="table table-bordered">
                    <thead class="create-event-table">
                        <tr class="text-center">
                            <th scope="col">№</th>
                            <th scope="col">Предметная область</th>
                            <th scope="col">Максимальный балл</th>
                            <th scope="col">Время проверки (мин):</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for pattern_task in pattern_tasks %}
                            <tr id="task-{{ pattern_task.id }}">
                                <td style="width: 50px;"><input name="task_num" class="w-100" type="number" readonly="readonly" required value="{{ pattern_task.task_num }}"></td>
                                <td>
                                    <select name="subject" class="w-100" id="inputEventSubject" required>
                                        <option disabled>Предметная область</option>
                                        {% for subject in subjects %}
                                            <option {% if pattern_task.subject == subject.id %} selected {% endif %} value={{ subject.id }}>{{ subject.name }}</option>
                                        {% endfor %}
                                    </select>
                                </td>
                                <td><input name="max_score" class="w-100" id="inputEventMaxScore" type="number" min="0" max="100" required value="{{ pattern_task.max_score }}"></td>
                                <td><input name="check_times" class="w-100" id="inputCheckTime" type="number" min="1" required value="{{ pattern_task.check_times }}"></td>
                            </tr>
                    {% endfor %}
                    </tbody>
                </table>
                <input class="btn btn-primary mt-3" type="submit" value="Сохранить"/>
            </form>
        </div>

        <div class="matching-criteria mt-4 ms-2 pb-3">
            <div class="head">
                <button class="d-inline image-button btn btn-sm btn-light">
                    <i class="fas fa-chevron-down"></i>
                </button>
                <h5 class="align-middle d-inline">Загрузка критериев</h5>
            </div>
            <div class="row px-3 py-3">
                <form id="matching-criteria-form">
                    <table class="table table-bordered">
                        <thead class="matching-criteria-table">
                            <tr class="text-center">
                                <th scope="col">Вариант</th>
                                <th scope="col">Текущие критерии</th>
                                <th scope="col">Новые критерии</th>
                            </tr>
                        </thead>
                        <tbody>
                        {% for variant in variants %}
                            <tr id="variant-{{ variant.id }}">
                                <td><input name="variant_name" class="w-100 align-middle fw-bolder" type="text" readonly="readonly" value="{{ variant.file_name }}"></td>
                                <td>
                                    {% if variant.criteria_obj.id %}
                                        <button class="btn btn-danger" id="{{ variant.criteria_obj.id }}">{{ variant.criteria_obj.file_name }}</button>
                                    {% endif %}
                                </td>
                                <td><input name="new_criteria_file" type="file" accept="application/pdf"></td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                    <input class="mt-4 btn btn-primary" type="submit" value="Сохранить"/>
                </form>
            </div>
        </div>
    </main>

    <!-- Модальное окно -->
    <div class="block-page" style="display: none;">

        <div id="modal-view-file" class="modal-view-file p-3" style="display: none;">
            <div class="head"><button class="ms-1" id="close-modal"><i class="fa-solid fa-xmark"></i></button></div>
            <iframe id='pdf' src='' width="100%" height="100%"></iframe>
        </div>
    </div>
{% endblock %}
{% block scripts %}
    <script src="{% static 'js/pages/edit_event.js' %}"></script>
{% endblock %}